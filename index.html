<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fanuc CNC G-Code Generator</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
body { font-family: 'Inter', sans-serif; }
.input-group { position: relative; }
.input-unit { position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 0.875rem; }
.tab-btn { transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; }
.tab-btn.active { background-color: #4f46e5; color: white; }
.tab-btn:not(.active) { background-color: #374151; color: #d1d5db; }
</style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

<div class="w-full max-w-2xl bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl border border-gray-700">
<h1 class="text-2xl sm:text-3xl font-bold text-center mb-6 text-indigo-400">CNC G-Code Generator (Fanuc)</h1>

<div class="flex justify-center mb-6 bg-gray-700 rounded-lg p-1">
<button id="face-milling-tab" class="tab-btn w-1/3 py-2 rounded-md text-sm font-semibold">Face Milling</button>
<button id="profile-milling-tab" class="tab-btn w-1/3 py-2 rounded-md text-sm font-semibold active">Profile Milling</button>
<button id="pcd-tab" class="tab-btn w-1/3 py-2 rounded-md text-sm font-semibold">PCD Drilling</button>
</div>

<!-- Face Milling Inputs Section -->
<div id="face-milling-inputs" class="hidden">
<!-- [Inputs same as before, omitted for brevity in this snippet] -->
</div>

<!-- Profile Milling Inputs Section -->
<div id="profile-milling-inputs">
<div class="space-y-6">
<div>
<h2 class="text-lg font-semibold text-gray-300 mb-2 border-b border-gray-700 pb-2">Step 1: Select Working Plane</h2>
<select id="pm-plane-select" class="w-full bg-gray-700 rounded-lg p-3">
<option value="G17">G17 (X-Y Plane)</option>
<option value="G18">G18 (X-Z Plane)</option>
<option value="G19">G19 (Y-Z Plane)</option>
</select>
</div>

<div>
<h2 class="text-lg font-semibold text-gray-300 mb-2 border-b border-gray-700 pb-2">Step 2: Workpiece & Tool</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div><label id="size1-label" for="workpiece-size1" class="block text-sm font-medium">Workpiece Size (X)</label>
<div class="input-group"><input type="number" id="workpiece-size1" class="w-full bg-gray-700 rounded-lg p-3" placeholder="e.g., 200"><span class="input-unit">mm</span></div></div>

<div><label id="size2-label" for="workpiece-size2" class="block text-sm font-medium">Workpiece Size (Y)</label>
<div class="input-group"><input type="number" id="workpiece-size2" class="w-full bg-gray-700 rounded-lg p-3" placeholder="e.g., 100"><span class="input-unit">mm</span></div></div>

<div><label for="cutter-diameter" class="block text-sm font-medium">Cutter Diameter</label>
<div class="input-group"><input type="number" id="cutter-diameter" class="w-full bg-gray-700 rounded-lg p-3" placeholder="e.g., 20"><span class="input-unit">mm</span></div></div>
</div>
</div>

<div>
<h2 class="text-lg font-semibold text-gray-300 mb-2 border-b border-gray-700 pb-2">Step 3: Machining Parameters</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
<div><label id="final-depth-label" for="final-depth" class="block text-sm font-medium">Final Depth (Z)</label>
<div class="input-group"><input type="number" id="final-depth" class="w-full bg-gray-700 rounded-lg p-3" placeholder="e.g., -5"><span class="input-unit">mm</span></div></div>

<div><label for="depth-of-cut" class="block text-sm font-medium">Depth of Cut</label>
<div class="input-group"><input type="number" id="depth-of-cut" class="w-full bg-gray-700 rounded-lg p-3" placeholder="e.g., 1"><span class="input-unit">mm</span></div></div>

<div><label for="safety-distance" class="block text-sm font-medium">Safety Distance</label>
<div class="input-group"><input type="number" id="safety-distance" value="5" class="w-full bg-gray-700 rounded-lg p-3"><span class="input-unit">mm</span></div></div>
</div>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
<div><label for="corner-radius" class="block text-sm font-medium">Corner Radius</label>
<div class="input-group"><input type="number" id="corner-radius" class="w-full bg-gray-700 rounded-lg p-3" placeholder="Optional"><span class="input-unit">mm</span></div></div>

<div><label for="material-select" class="block text-sm font-medium">Material</label>
<select id="material-select" class="w-full bg-gray-700 rounded-lg p-3">
<option value="mild-steel">Mild Steel</option>
<option value="inox">Inox (Stainless)</option>
</select></div>

<div><label for="tool-offset-d" class="block text-sm font-medium">Tool Offset (D)</label>
<input type="number" id="tool-offset-d" value="1" class="w-full bg-gray-700 rounded-lg p-3"></div>
</div>
</div>

<div>
<h2 class="text-lg font-semibold text-gray-300 mb-2 border-b border-gray-700 pb-2">Step 4: Select Origin</h2>
<select id="pm-origin-select" class="w-full bg-gray-700 rounded-lg p-3 mt-1">
<option value="center">Center</option>
<option value="bottom-left">X- Y-</option>
<option value="top-left">X- Y+</option>
<option value="bottom-right">X+ Y-</option>
<option value="top-right">X+ Y+</option>
</select>
</div>
</div>
</div>

<!-- PCD Drilling Inputs Section (Hidden by default) -->
<div id="pcd-inputs" class="hidden">
<!-- [Inputs same as before] -->
</div>

<div class="flex mt-6">
<button id="generate-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition">Generate G-Code</button>
</div>

<div id="results-section" class="mt-8 pt-6 border-t border-gray-700 hidden">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-semibold text-indigo-400">Generated Program</h2>
<button id="copy-btn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg transition text-sm">Copy Code</button>
</div>
<pre id="gcode-output" class="bg-gray-900 text-white p-4 rounded-lg text-sm whitespace-pre-wrap max-h-96 overflow-y-auto"></pre>
</div>
<div id="error-message" class="mt-4 text-center text-red-400 font-medium hidden"></div>
</div>

<script>
// [JavaScript same as your current code]
// Only change is in buildProfileMillingProgram:
function buildProfileMillingProgram(inputs, params) {
    const { plane, size1, size2, finalDepth, doc, safetyDist, cornerRadius, toolOffset, origin } = inputs;
    const { rpm, feed } = params;
    const axes = getProfileAxes(plane);
    const halfP1 = size1/2, halfP2=size2/2;
    let offsetX=0, offsetY=0;
    if(origin==='bottom-left'){offsetX=halfP1; offsetY=halfP2;}
    else if(origin==='top-left'){offsetX=halfP1; offsetY=-halfP2;}
    else if(origin==='bottom-right'){offsetX=-halfP1; offsetY=halfP2;}
    else if(origin==='top-right'){offsetX=-halfP1; offsetY=-halfP2;}

    const startP1 = -halfP1 + offsetX;
    const startP2 = -halfP2 + offsetY;
    const endP1 = halfP1 + offsetX;
    const endP2 = halfP2 + offsetY;
    const safeZ = 50;
    const cutterSafety = toolOffset + safetyDist;

    let program = `O0002 (PROFILE MILLING)\n${plane} G90 G40 G80\nG54\nT${toolOffset} M6\nS${rpm} M03\nG43 H${toolOffset} G00 ${axes.depth}${safeZ}\nM8\n\n#1=0\n#2=${finalDepth.toFixed(3)}\n#3=${doc.toFixed(3)}\n\n`;
    program += `N10\nG00 ${axes.p1}${startP1.toFixed(3)} ${axes.p2}${(startP2+cutterSafety).toFixed(3)}\n`;
    program += `#1=#1-#3\nIF[#1 LT #2] THEN #1=#2\nG00 ${axes.depth}${safeZ}\nG01 ${axes.depth}#1 F${(feed/2).toFixed(0)}\n`;
    program += `G01 ${axes.p2}${startP2.toFixed(3)} F${feed}\nG41 D${toolOffset}\n`;
    program += `G01 ${axes.p1}${endP1.toFixed(3)}\nG01 ${axes.p2}${endP2.toFixed(3)}\nG01 ${axes.p1}${startP1.toFixed(3)}\nG01 ${axes.p2}${startP2.toFixed(3)}\n`;
    program += `G40\nG00 ${axes.depth}${safeZ}\nIF[#1 GT #2] GOTO N10\nM5\nM9\nG28 G91 ${axes.depth}0\nM30\n%`;
    return program.trim();
}
</script>
</body>
</html>
